"use strict";var REVERSI=REVERSI||{};$(function(){REVERSI={val:{event:"click",turn:0,undoBoard:[],undoTurn:0,auto:0,cpu:[],vsCpu:!1},getTurn:function(){return REVERSI.val.turn%2==0?"w":"b"},setTurn:function(){REVERSI.val.turn=REVERSI.val.turn+1},resetTurn:function(){REVERSI.val.turn=0,REVERSI.val.undoBoard=[]},getCellObj:function(){var e=void 0===arguments[0]?0:arguments[0],E=void 0===arguments[1]?0:arguments[1];return $(".cell").eq(8*E+e)},getCellColor:function(){var e=void 0===arguments[0]?0:arguments[0],E=void 0===arguments[1]?0:arguments[1];return $(".cell").eq(8*E+e).attr("class").replace(/cell/,"").replace(/\s/,"")},getXy:function(e){var E=e.index();return{x:E%8,y:Math.floor(E/8)}},setStone:function(){var e=void 0===arguments[0]?0:arguments[0],E=void 0===arguments[1]?0:arguments[1],R=REVERSI.getCellObj(e,E),l=REVERSI.checkCell(e,E);if(l.length>0){REVERSI.val.undoBoard.push([$("#board").clone(),REVERSI.val.turn]),REVERSI.val.undoTurn=REVERSI.val.turn,$("#undo").removeClass("disable"),R.removeClass().addClass("cell "+REVERSI.getTurn());for(var t=l.length,a=0;a<t;a++)l[a].removeClass().addClass("cell "+REVERSI.getTurn());REVERSI.setTurn(),REVERSI.writeMessage()}return Boolean(l.length>0)},setCell:function(e,E,R){var l=REVERSI.getCellObj(e,E),t=!1;if(void 0===R)if(REVERSI.checkSettable())t=REVERSI.setStone(e,E);else{var a="白";"b"===REVERSI.getTurn()&&(a="黒"),alert("石を置ける場所がないので、「"+a+"」の順番をスキップします"),REVERSI.setTurn()}else l.addClass(R),t=!0;return t},checkCell:function(){for(var e=void 0===arguments[0]?0:arguments[0],E=void 0===arguments[1]?0:arguments[1],R=REVERSI.getTurn(),l=REVERSI.getCellObj(e,E),t=[[[],[]],[[],[]],[[],[]],[[],[]]],a=[],n=0;n<8;n++){t[0][0].push(REVERSI.getCellObj(n,E)),t[0][1].push(REVERSI.getCellColor(n,E)),t[1][0].push(REVERSI.getCellObj(e,n)),t[1][1].push(REVERSI.getCellColor(e,n));var r=n-e+E,o=-1*(n-e)+E;r>=0&&r<8&&(t[2][0].push(REVERSI.getCellObj(n,r)),t[2][1].push(REVERSI.getCellColor(n,r))),o>=0&&o<8&&(t[3][0].push(REVERSI.getCellObj(n,o)),t[3][1].push(REVERSI.getCellColor(n,o)))}for(var u=0;u<=3;u++){for(var i=t[u][0].length,v=0,s=0;s<i;s++)if(t[u][0][s].index()==l.index()){v=s;break}var I=-1,S=-1;if(t[u][1][v-1]!=R&&""!=t[u][1][v-1])for(var d=v-2;d>=0;d--){if(t[u][1][d]===R){I=d;break}if(""===t[u][1][d])break}if(t[u][1][v+1]!=R&&""!=t[u][1][v+1])for(var V=v+2;V<i;V++){if(t[u][1][V]===R){S=V;break}if(""===t[u][1][V])break}if(I>=0)for(var c=I+1;c<v;c++)a.push(t[u][0][c]);if(S>=0)for(var f=v+1;f<S;f++)a.push(t[u][0][f])}return a},checkSettable:function(){for(var e=REVERSI.val.cpu.length,E=!1,R=0;R<e;R++){var l=$(".cell")[REVERSI.val.cpu[R]],t=REVERSI.getXy($(l));if(REVERSI.checkCell(t.x,t.y).length>0){E=!0;break}}return E},doCpu:function(){var e=$(".cell")[REVERSI.val.cpu[0]],E=REVERSI.getXy($(e)),R=REVERSI.getCellObj(E.x,E.y),l=!1;return R.hasClass("b")||R.hasClass("w")||(l=REVERSI.setCell(E.x,E.y)),l?REVERSI.val.cpu.shift():REVERSI.val.cpu.push(REVERSI.val.cpu.shift()),l},makeCpuStep:function(){for(var e=[],E=0;E<64;E++)e.push(E);REVERSI.val.cpu=e.filter(function(e){return 27!==e&&28!==e&&35!==e&&36!==e});for(var R=REVERSI.val.cpu.length,l=R-1;l>=0;l--){var t=Math.floor(Math.random()*(l+1)),a=REVERSI.val.cpu[l];REVERSI.val.cpu[l]=REVERSI.val.cpu[t],REVERSI.val.cpu[t]=a}},createBoard:function(){$("#board .cell").remove();for(var e=0;e<64;e++)$("#board").append("<div class='cell'></div>");$("#board .cell").on(REVERSI.val.event,function(){var e=$(this);if(!e.hasClass("b")&&!e.hasClass("w")){var E=REVERSI.getXy(e);REVERSI.setCell(E.x,E.y)}if(REVERSI.val.vsCpu)do{REVERSI.doCpu()}while(cpu)})},writeMessage:function(){var e=$("#message"),E=$(".b").length,R=$(".w").length,l=E+R,t="";l<64?(t="w"==REVERSI.getTurn()?"白":"黒",e.text(t+"のターン 白："+R+"／黒："+E)):(E>R&&(t="黒の勝ち！"),E<R&&(t="白の勝ち！"),E===R&&(t="引き分け！"),e.html("白："+R+"／黒："+E+"で、<br>"+t),REVERSI.resetTurn(),0!==REVERSI.val.auto&&(clearInterval(REVERSI.val.auto),REVERSI.val.auto=0))},cellInit:function(){REVERSI.resetTurn(),REVERSI.makeCpuStep(),REVERSI.createBoard(),REVERSI.setCell(3,3,"w"),REVERSI.setCell(4,4,"w"),REVERSI.setCell(3,4,"b"),REVERSI.setCell(4,3,"b"),0!==REVERSI.val.auto&&(clearInterval(REVERSI.val.auto),REVERSI.val.auto=0)},init:function(){document.addEventListener("touchstart",function(){},!1),$("body").append("<div id='container'></div>"),$("#container").append("<div id='board'></div>"),$("#container").append("<div id='info'></div>"),$("#info").append("<div id='message'></div>"),REVERSI.cellInit(),REVERSI.writeMessage(),$("#info").append("<button id='undo'>一手戻し</button>"),$("#undo").addClass("disable"),$("#undo").on(REVERSI.val.event,function(){if(!$(this).hasClass("disable")){var e=REVERSI.val.undoBoard.pop(),E=e[0].children(),R=e[1];$("#board").empty().append(E),REVERSI.val.turn=R,$(this).addClass("disable"),REVERSI.writeMessage()}}),$("#info").append("<button id='auto'>全自動</button>"),$("#auto").on(REVERSI.val.event,function(){REVERSI.cellInit(),REVERSI.resetTurn(),REVERSI.val.auto=setInterval(function(){REVERSI.doCpu()},1)})}},REVERSI.init()});